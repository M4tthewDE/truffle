<style>
	.chat-room-div {
		height: 400px;
		overflow: auto;
		border: 1px solid #ccc;
		padding: 10px;
	}
</style>

#{{.Channel}}
<div id="chat-room-div" class="chat-room-div" hx-ext="ws" ws-connect="/chat/messages?channel={{.Channel}}">
	<div id="messages"></div>
</div>

<script>
	htmx.on("htmx:oobAfterSwap", function (evt) {
		if (evt.detail.target.attributes["id"].nodeValue === "messages") {
			const container = document.getElementById("chat-room-div");
			container.scrollTop = container.scrollHeight;

			const messages = document.getElementById("messages");
			const children = messages.children;
			const limit = 500;
			const excess = children.length - limit;

			for (let i = 0; i < excess; i++) {
				messages.removeChild(children[0])
			}
		}
	});
	htmx.on("htmx:wsOpen", function (evt) {
		if (evt.detail.elt.attributes["id"].nodeValue === "chat-room-div") {
			const messages = document.getElementById("messages");
			messages.appendChild(connectedSpan);
		}
	});
</script>
